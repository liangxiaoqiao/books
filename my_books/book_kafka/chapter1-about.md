#### Kafka
##### 基本概念
1. 主题
    - 也就是Topic，是对消息的分类
    - 生产者发送消息到特定的主题
    - 消费者订阅主题或者主题的某些分区进行消费
2. 消息
    - 通信的基本单位
    - 固定长度的消息头+可变长度的消息体 组成
3. 分区和副本
	- 一组消息归纳为一个主题，一个主题分成一个或多个分区
		- 分区由：有序、不可变的消息组成（有序队列）
		- 每个分区有一至多个副本。副本在集群的不同代理上
	- 只保证一个分区内消息的有序性
	- 追加消息是顺序写磁盘，效率非常高
	- 不会立即删除消息
		- 基于消息已存储的时间
		- 基于分区的大小
4. Leader副本和Follower副本
	- 选择分区的一个副本为Leader副本，其他为Follower副本
	- Leader负责客户端读写请求，Follower副本从Leader同步数据
	- Leader失效，选举算法从其他Follower副本中选出新的Leader
	- 保证了数据的一致性和顺序性
5. 偏移量
    - 消息直接追加到日志文件的尾部
    - 每条消息在日志文件中的位置都会对应一个按序递增的偏移量
    - 已消费消息的偏移量也需要保存（保证消息被顺序消费）
    - 几乎不允许对消息进行随机读写
6. 日志段
    - 一个日志被划分为多个日志段
    - 日志对象分片的最小单位
    - 日志段对应.log日志文件和两个索引文件.index .timeindex
7. 代理
    - 一个Kafka实例就是一个代理，也就是Kafka服务器
8. 生产者
    - 负责将消息发送给代理，也就是向Kafka代理发送消息的客户端
9. 消费者和消费组
    - 消费者以pull方式拉取数据
    - 每一个消费者都属于一个特定的消费组
    - 同一个主题的一条消息只能被同一个消费组下某一个消费者消费
    - 不同消费组的消费者可以同事消费该消息
    - 消费组来实现对一个主题消息进行广播和单播
    - 广播：制定多个消费者属于不同消费组 单播：制定多个消费者属于同一个消费组
1. ISR
    - 保存同步的副本列表，保存与Leader保持消息同步的代理节点ID
1. ZooKeeper
    - Kafka利用Zookeeper保存相应元数据信息，如 代理节点/kafka集群/主题信息/分区状态信息/分区副本分配方案/动态配置等。
    - Kafka通过监听机制，在节点注册相应的监听器来监听节点元数据的变化
    - Zookeeper负责管理维护Kafka集群    